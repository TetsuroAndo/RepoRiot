# 開発ガイドライン

## 開発環境セットアップ

### 必要要件
- Node.js (v18以上)
- PostgreSQL (v14以上)
- Docker (オプション)

### 環境構築手順

1. リポジトリのクローン
```bash
git clone [repository-url]
cd backend-repo
```

2. 依存パッケージのインストール
```bash
pnpm install
```

3. 環境変数の設定
```bash
cp .env.example .env
```
必要な環境変数を設定してください。

4. データベースのセットアップ
```bash
pnpm prisma migrate dev
```

5. アプリケーションの起動
```bash
pnpm dev
```

## コーディング規約

### 全般
- TypeScriptの型を積極的に活用する
- any型の使用は避ける
- コメントは必要最小限にとどめ、コードの意図が明確になるように記述する

### ファイル構成
- 1ファイルにつき1つの主要な機能を実装する
- ファイル名はケバブケース（例: user-service.ts）を使用する
- テストファイルは`.spec.ts`または`.test.ts`の拡張子を使用する

### 命名規則
- クラス名: パスカルケース（例: UserService）
- 変数名・関数名: キャメルケース（例: getUserById）
- 定数: スネークケース大文字（例: MAX_RETRY_COUNT）
- インターフェース名: 接頭辞に'I'をつける（例: IUserRepository）

### エラーハンドリング
- 適切なエラークラスを使用する
- エラーメッセージは具体的で理解しやすいものにする
- エラーログは適切なレベル（info, warn, error）で出力する

## テスト規約

### ユニットテスト
- 各機能の最小単位でテストを作成する
- モックは必要最小限にとどめる
- テストケースは境界値を含める

### 統合テスト
- 主要なAPIエンドポイントのテストを作成する
- データベース操作を含むテストは独立した環境で実行する

## GitFlow

### ブランチ戦略
- main: プロダクション環境用
- develop: 開発用メインブランチ
- feature/*: 新機能開発用
- bugfix/*: バグ修正用
- release/*: リリース準備用

### コミットメッセージ
以下のプレフィックスを使用する：
- feat: 新機能
- fix: バグ修正
- docs: ドキュメントのみの変更
- style: コードスタイルの変更
- refactor: リファクタリング
- test: テストコードの追加・修正
- chore: ビルドプロセスやツールの変更

例：
```
feat: ユーザー認証機能の追加
fix: ログイン時のセッション管理の修正
docs: APIドキュメントの更新
```

## デプロイメント

### 本番環境
1. mainブランチへのマージ
2. GitHub Actionsによる自動テスト
3. 自動デプロイ（成功時）

### ステージング環境
1. developブランチへのマージ
2. GitHub Actionsによる自動テスト
3. 自動デプロイ（成功時）

## セキュリティガイドライン

### 認証・認可
- JWTトークンの有効期限を適切に設定する
- センシティブな情報は暗号化して保存する
- CORS設定を適切に行う

### データ保護
- ユーザーパスワードはハッシュ化して保存
- APIキーなどの機密情報は環境変数で管理
- SQLインジェクション対策としてPrismaのクエリビルダーを使用

### ログ管理
- 個人情報を含むログは暗号化または匿名化
- エラーログは適切なレベルで記録
- 本番環境ではスタックトレースを非表示
